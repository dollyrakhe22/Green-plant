<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plant a Tree</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50">

  <!-- ðŸŒ´ Header -->
  <header class="bg-green-700 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Green Earth</h1>
    <button class="bg-yellow-400 text-black px-4 py-2 rounded">Donate</button>
  </header>

  <!-- ðŸŒ´ Categories -->
  <section class="flex gap-6 p-6">
    <aside class="w-">
      <h2 class="text-lg font-bold mb-3">Categories</h2>
      <div id="category-container" class="flex flex-col gap-2">
        <!-- Dynamic Category Buttons -->
      </div>
    </aside>

    <!-- ðŸŒ´ Tree Cards -->
    <main class="w-4/5">
      <h2 class="text-center text-xl font-bold mb-4">Choose Your Trees</h2>
      
      <!-- Spinner -->
      <div id="loading-spinner" class="hidden text-center">
        <div class="w-10 h-10 border-4 border-green-600 border-dashed rounded-full animate-spin mx-auto"></div>
      </div>

      <!-- Cards Grid -->
      <div id="tree-container" class="grid md:grid-cols-3 gap-6">
        <!-- Dynamic Tree Cards -->
      </div>
    </main>

    <!-- ðŸŒ´ Cart -->
    <aside class="w-1/5 bg-white shadow-lg p-4 rounded">
      <h2 class="font-bold mb-3">Your Cart</h2>
      <ul id="cart-list" class="space-y-2"></ul>
      <p class="mt-3 font-bold">Total: $<span id="cart-total">0</span></p>
    </aside>
  </section>

  <!-- ðŸŒ´ Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-white p-6 rounded-lg w-96 relative">
      <button id="modal-close" class="absolute top-2 right-2 text-red-500 font-bold">X</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    const categoryContainer = document.getElementById("category-container");
    const treeContainer = document.getElementById("tree-container");
    const cartList = document.getElementById("cart-list");
    const cartTotal = document.getElementById("cart-total");
    const spinner = document.getElementById("loading-spinner");
    let total = 0;

    // ðŸŒ´ Load Categories
    const loadCategories = async () => {
      const res = await fetch("https://openapi.programming-hero.com/api/categories");
      const data = await res.json();
      displayCategories(data.categories);
    };

    const displayCategories = (categories) => {
      categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.innerText = cat.category;
        btn.className = "px-3 py-2 rounded bg-green-200 hover:bg-green-400";
        btn.onclick = () => loadTrees(cat.category_id, btn);
        categoryContainer.appendChild(btn);
      });
    };

    // ðŸŒ´ Load Trees by Category
    const loadTrees = async (id, btn) => {
      spinner.classList.remove("hidden");
      [...categoryContainer.children].forEach(b => b.classList.remove("bg-green-600", "text-white"));
      btn.classList.add("bg-green-600", "text-white");

      const res = await fetch(`https://openapi.programming-hero.com/api/category/${id}`);
      const data = await res.json();
      displayTrees(data.data);
      spinner.classList.add("hidden");
    };

    const displayTrees = (trees) => {
      treeContainer.innerHTML = "";
      trees.forEach(tree => {
        const div = document.createElement("div");
        div.className = "bg-white shadow rounded p-3";
        div.innerHTML = `
          <img src="${tree.image}" alt="${tree.name}" class="w-full h-40 object-cover rounded">
          <h3 class="font-bold text-lg cursor-pointer text-green-600 hover:underline" onclick="showModal(${tree.id})">${tree.name}</h3>
          <p class="text-sm text-gray-600">${tree.category}</p>
          <p class="font-semibold">$${tree.price}</p>
          <button onclick="addToCart('${tree.name}', ${tree.price})" class="bg-green-600 text-white px-3 py-1 rounded mt-2">Add to Cart</button>
        `;
        treeContainer.appendChild(div);
      });
    };

    // ðŸŒ´ Modal
    const showModal = async (id) => {
      const res = await fetch(`https://openapi.programming-hero.com/api/plant/${id}`);
      const data = await res.json();
      const plant = data.plant;
      document.getElementById("modal-content").innerHTML = `
        <img src="${plant.image}" alt="${plant.name}" class="w-full h-40 object-cover rounded mb-3">
        <h2 class="text-xl font-bold">${plant.name}</h2>
        <p>${plant.description}</p>
        <p class="font-semibold mt-2">Price: $${plant.price}</p>
      `;
      document.getElementById("modal").classList.remove("hidden");
    };

    document.getElementById("modal-close").onclick = () => {
      document.getElementById("modal").classList.add("hidden");
    };

    // ðŸŒ´ Cart
    const addToCart = (name, price) => {
      const li = document.createElement("li");
      li.className = "flex justify-between items-center bg-gray-100 p-2 rounded";
      li.innerHTML = `
        ${name} - $${price}
        <button onclick="removeFromCart(this, ${price})" class="text-red-500 font-bold">X</button>
      `;
      cartList.appendChild(li);
      total += price;
      cartTotal.innerText = total;
    };

    const removeFromCart = (btn, price) => {
      btn.parentElement.remove();
      total -= price;
      cartTotal.innerText = total;
    };

    // Initial Load
    loadCategories();
  </script>

</body>
</html>
